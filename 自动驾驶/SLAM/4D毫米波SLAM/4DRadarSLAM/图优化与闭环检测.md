- [零、问题 \& 概念 \& 数据结构](#零问题--概念--数据结构)
  - [概念](#概念)
        - [1. 下限系数](#1-下限系数)
        - [2. 信息矩阵](#2-信息矩阵)
        - [3. 状态估计](#3-状态估计)
        - [4. 环键 \& 扇形键](#4-环键--扇形键)
  - [问题](#问题)
        - [1. `new_keyframes` 和 `keyframes` 的区别](#1-new_keyframes-和-keyframes-的区别)
        - [2. 信息矩阵在回环检测中的作用](#2-信息矩阵在回环检测中的作用)
  - [数据结构](#数据结构)
        - [1. 上下文描述符](#1-上下文描述符)
        - [2. 环键 \& 扇形键](#2-环键--扇形键)
        - [3. 关键帧](#3-关键帧)
        - [4. 位姿图](#4-位姿图)
- [一、闭环检测](#一闭环检测)
  - [1. flush\_keyframe\_queue()](#1-flush_keyframe_queue)
  - [2. optimization\_timer\_callback()](#2-optimization_timer_callback)
  - [3. addLoopFactor()](#3-addloopfactor)
- [二、radar\_graph\_slam](#二radar_graph_slam)
  - [1. loop\_detector](#1-loop_detector)
- [三、g2o](#三g2o)
- [四、scan\_context](#四scan_context)
  - [1. KDTreeVectorOfVectorsAdaptor.h](#1-kdtreevectorofvectorsadaptorh)
  - [2. nanflann.hpp](#2-nanflannhpp)
        - [相关连接：](#相关连接)
        - [作用：](#作用)
        - [如何使用：](#如何使用)
  - [3. Scancontext](#3-scancontext)
    - [3.1 SCManager](#31-scmanager)
    - [3.2 setScDistThresh](#32-setscdistthresh)
    - [3.3 setAzimuthRange](#33-setazimuthrange)
    - [3.4 makeScancontext](#34-makescancontext)
    - [3.5 makeRingkeyFromScancontext](#35-makeringkeyfromscancontext)
    - [3.6 makeSectorkeyFromScancontext](#36-makesectorkeyfromscancontext)
    - [3.7 fastAlignUsingVkey](#37-fastalignusingvkey)
    - [3.8 distDirectSC](#38-distdirectsc)
    - [3.9 distanceBtnScanContext](#39-distancebtnscancontext)
    - [3.10 makeAndSaveScancontextAndKeys](#310-makeandsavescancontextandkeys)
    - [3.11 detectLoopClosureID](#311-detectloopclosureid)
  - [4. tictor.h](#4-tictorh)


# 零、问题 & 概念 & 数据结构

## 概念

##### 1. 下限系数

##### 2. 信息矩阵

Information Matrix

是协方差矩阵的逆矩阵。

- **协方差矩阵**描述了状态估计的不确定性
- **信息矩阵**描述了状态估计的确定性

##### 3. 状态估计

- 状态估计是指通过测量和算法来推断系统当前状态的过程。

- 在SLAM中，状态估计指的是机器人在环境中位姿的估计。

##### 4. 环键 & 扇形键

环键

- 点云数据在径向（距离）上的离散化。
- 雷达捕获到的点按照与中心点的距离被分到不同的环（rings）中。每个环代表了一定距离范围内的点云数据。

扇形键

- 点云数据在角向（方位角）上的离散化。
- 在极坐标系中，每个点的位置都可以用一个方位角和一个距离表示。扇形键将360度的视角分割成多个扇形区域。

结合使用

- 可以将激光雷达的点云数据组织成一个二维矩阵

- 行代表环，列代表扇形，每个单元格内的数值表示该环和扇形组合内点的数量。

- 这样，整个点云就被转换成了一个描述环境特征的直方图。

  

## 问题

##### 1. `new_keyframes` 和 `keyframes` 的区别

##### 2. 信息矩阵在回环检测中的作用

1. **表示约束的置信度**：

   信息矩阵表示一个节点到另一节点的位姿约束（位姿变换）的置信度。较大的信息矩阵表示较大的置信度。

2. **影响优化结果**：

   高置信度的约束对优化结果有更大的影响力。

3. **控制噪声的传播**：

   精确的位姿估计具有



## 数据结构

##### 1. 上下文描述符

- `MatrixXd`

##### 2. 环键 & 扇形键

- `MatrixXd`

##### 3. 关键帧



##### 4. 位姿图



#  一、闭环检测

## 1. flush_keyframe_queue()

- 描述
  - 添加所有关键帧到位姿图中

## 2. optimization_timer_callback()

- 描述
  - 将队列中的所有数据添加到位姿图中，然后优化位姿图。
    - 包括关键帧、下限系数
- 参数
  - `event`
    - **参数类型**：`ros::WallTimerEvent&`
    - 定时器回调函数的参数
- 关键变量
  - 

## 3. addLoopFactor()

- 描述
  - 将检测到的回环添加到位姿图中
    - 使用 `graph_slam->add_se3_edge(s)` 函数
  - 为回环边添加==鲁棒核函数==
    - `graph->add_robust_kernel()`
- 关键变量
  - `loop_detector`
  - 


# 二、radar_graph_slam

## 1. loop_detector

1.1 LoopDetector

- 描述
  - 构造函数
- 关键参数
  - scManager
    - **参数类型**：`std::unique_ptr<SCManager>`
    - SCManager 类的实例化对象指针

# 三、g2o

# 四、scan_context

## 1. KDTreeVectorOfVectorsAdaptor.h





## 2. nanflann.hpp

只需要知道怎么使用，不用解读源码

##### 相关连接：

https://blog.csdn.net/u013019296/article/details/109377104

##### 作用：

用于构建具有**不同拓扑**的 KD 树

- R2
- R3：点云
- SO(2)：2D旋转组
- SO(3)：3D旋转组

##### 如何使用：



## 3. Scancontext

定义类 `SCManager`

### 3.1 SCManager

- 描述
  - 构造函数，使用默认无参

### 3.2 setScDistThresh

- 描述
  - 设置距离阈值

### 3.3 setAzimuthRange

- 描述
  - 设置 Azimuth 角度

### 3.4 makeScancontext

- 描述

  - 从点云下采样生成扫描上下文描述符

- 返回值

  - **类型**：`Eigen::MatrixXd`

    

### 3.5 makeRingkeyFromScancontext

- 描述
  - 从扫描上下文描述符生成环键
- 返回值
  - **类型**：`Eigen::MatrixXd`

### 3.6 makeSectorkeyFromScancontext

- 描述
  - 从扫描上下文生成扇形键
- 返回值
  - **类型**：`Eigen::MatrixXd`

### 3.7 fastAlignUsingVkey

- 描述
  - 执行两个键之间的快速对齐
    - 这里只用于两个扇形键，排除方位角对于闭环检测的影响。
  - 索引从 0 遍历到 `_vkey1` 的行数，对于每一个索引，变换 `_vkey2`，得到使得 `_vkey1` 和 变换后的`_vkey2` 之间距离最近的索引。
- 关键变量
  - `argmin_vkey_shift`
    - 表示两个键之间的最佳变换的索引
    - 初始值为 0
  - `min_vkey_diff_norm`
    - 存储 `_veky1`  和 变换之后的 `_vkey2` 之间的**最小范式(距离)**
- 返回值
  - `argmin_vkey_shift`

### 3.8 distDirectSC

- 描述
  - 计算两个上下文描述符的直接距离

### 3.9 distanceBtnScanContext

- 描述
  - 计算两个上下文描述符之间的直接距离和角度差异

### 3.10 makeAndSaveScancontextAndKeys

- 描述
  - 生成扫描上下文和键
- **输入**：`_scan_down`
  - 下采样点云
  - 类型：`pcl::PointCloud<SCPointType> &`

### 3.11 detectLoopClosureID

- 描述
  - ==检测闭环ID==

## 4. tictor.h